generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Cafe {
  id                Int               @id @default(autoincrement())
  slug              String            @unique
  name              String
  address           String
  latitude          Decimal?          @db.Decimal(10, 8)
  longitude         Decimal?          @db.Decimal(11, 8)
  googleMapsUrl     String?           @map("google_maps_url")
  instagramUrl      String?           @map("instagram_url")
  parking           String?
  priceMin          Int?              @map("price_min")
  priceMax          Int?              @map("price_max")
  priceRange        String?           @map("price_range")
  createdAt         DateTime          @default(now()) @map("created_at")
  updatedAt         DateTime          @updatedAt @map("updated_at")
  instagramUsername String?           @map("instagram_username")
  mainImageId       Int?              @map("main_image_id")
  images            CafeImage[]
  paymentMethods    CafePaymentMethod[]
  openingHours      OpeningHour[]
  facilities        CafeFacility[]

  @@map("cafes")
}

model CafeImage {
  id        Int      @id @default(autoincrement())
  cafeId    Int      @map("cafe_id")
  imageUrl  String   @map("image_url")
  alt       String?
  createdAt DateTime @default(now()) @map("created_at")
  cafe      Cafe     @relation(fields: [cafeId], references: [id], onDelete: Cascade)

  @@index([cafeId])
  @@map("cafe_images")
}

model OpeningHour {
  id             Int      @id @default(autoincrement())
  cafeId         Int      @map("cafe_id")
  dayOfWeek      String   @map("day_of_week")
  openTime       DateTime @map("open_time") @db.Time(0)
  closeTime      DateTime @map("close_time") @db.Time(0)
  isClosed       Boolean  @default(false) @map("is_closed")
  isEverydayOpen Boolean  @default(false) @map("is_everyday_open")
  isOpen24Hours  Boolean  @default(false) @map("is_open_24_hours")
  cafe           Cafe     @relation(fields: [cafeId], references: [id], onDelete: Cascade)

  @@unique([cafeId, dayOfWeek])
  @@map("opening_hours")
}

model PaymentMethod {
  id    Int                 @id @default(autoincrement())
  code  String              @unique
  label String
  cafes CafePaymentMethod[]

  @@map("payment_methods")
}

model CafePaymentMethod {
  cafeId          Int           @map("cafe_id")
  paymentMethodId Int           @map("payment_method_id")
  cafe            Cafe          @relation(fields: [cafeId], references: [id], onDelete: Cascade)
  paymentMethod   PaymentMethod @relation(fields: [paymentMethodId], references: [id], onDelete: Cascade)

  @@id([cafeId, paymentMethodId])
  @@index([paymentMethodId])
  @@map("cafe_payment_methods")
}

model Facility {
  id    Int            @id @default(autoincrement())
  code  String         @unique
  label String
  icon  String?
  cafes CafeFacility[]

  @@map("facilities")
}

model CafeFacility {
  cafeId     Int      @map("cafe_id")
  facilityId Int      @map("facility_id")
  cafe       Cafe     @relation(fields: [cafeId], references: [id], onDelete: Cascade)
  facility   Facility @relation(fields: [facilityId], references: [id], onDelete: Cascade)

  @@id([cafeId, facilityId])
  @@index([facilityId])
  @@map("cafe_facilities")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String?
  role      String   @default("admin")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("users")
}
